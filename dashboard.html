<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Dashboard - E.A.T</title>
        <link rel="stylesheet" href="./css/powerUsagePage.css">
        <link href="https://fonts.googleapis.com/css2?family=Kay+Pho+Du&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="./css/main.css">
        <link rel="stylesheet" href="./css/formstyles.css">
        <link rel="stylesheet" href="./css/dashboard.css">
        <link rel="stylesheet" href="./css/addDevice.css">
        <link rel="stylesheet" href="./css/thermostat.css">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </head>
    
    <body class="bodyLight">
        <!-- Loading and Error States -->
        <div id="loadingState">Loading dashboard...</div>
        <div id="errorDisplay"></div>
    
        <!-- Side Navigation -->
        <nav class="side-nav">
            <div class="nav-logo">
                <a href="user-profile.html"><img src="./images/icons/User Profile Icon.png" alt="User"></a>
            </div>
            <div class="nav-icons">
                <img src="./images/icons/notification bell.png" alt="Notifications" class="nav-icon">
                <a href="dashboard.html"><img src="./images/icons/Home Icon.png" alt="Home" class="nav-icon"></a>
                <a href="manage devices.html"><img src="./images/icons/tablet device (MIT licence).png" alt="Manage Devices" class="nav-icon"></a>
                <img src="./images/icons/Add Device Icon.png" alt="Add Device" class="nav-icon" onclick="showAddDevice()">
                <a href="powerUsage.html"><img src="./images/icons/View Stats Icon.png" alt="Stats" class="nav-icon"></a>
                
                <img src="./images/icons/settings cog (MIT).png" alt="Settings" class="nav-icon">
                
            </div>

            <div class="logout-icon">
                <button id="logoutBtn" class="logout-btn"><img src="./images/icons/logout icon.png" alt="Logout" title="Logout"></button>
            </div>
        </nav>
    
        <!-- Main Content -->
        <div id="dashboardContent" class="dashboard-container">
            <!-- Header Section -->
            <div class="header">
                <!-- Greeting Bubble -->
                <div class="greeting-bubble">
                    <div class="greeting-text">Hi, <span id="prefName"> Loading name...</span> ðŸ‘‹</div>

                    

                    <!-- Weather Information -->
                    <div class="weather-info">
                        <div id="current-temprature" class="temperature">Loading temprature...</div>
                        <div class="weather-desc">Loading weather description...</div>
                    </div>
                </div>
                
                <!-- User Profile -->
                <div class="user-profile">
                    <div class="profile-icon">
                        <a href="user-profile.html"><img src="./images/icons/User Profile Icon.png" alt="User"></a>
                    </div>

                    <div class="user-role" id="userRole">Loading role... </div>
                    <!--                     
                    <div>
                        <ul class="user-profile-options">
                            
                            

                        </ul>                        
                    </div> -->
                </div>
            </div>
            
            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- Devices Section -->
                <div class="devices-section">
                    <div class="section-header">
                        <div class="section-title">My Devices</div>
                    </div>
                    
                    <!-- Room Navigation -->
                    <div class="room-tabs" id="roomTabs">
                    </div>
                    
                    <!-- Devices Grid -->
                    <div class="devices-grid" id="devicesGrid">
                    </div>
                </div>
                
                <!-- Energy Consumption Section -->
                <div class="energy-section">
                    <div class="graph-header">
                        <div class="graph-title">Power Consumption</div>
                        <div class="graph-buttons">
                            <div class="graph-buttons">
                                <button id="daily">Daily</button>
                                <button id="weekly">Weekly</button>
                                <button id="monthly">Monthly</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chart -->
                    <div class="chart-container graph-container">
                        <canvas id="energyCostChart"></canvas>
                    </div>
                </div>

                <div class="sidebar-section">
                    
                    <!-- Thermostat Dial -->
                    
                    <div class="info-card temprature">
                        <div class="info-card-content">
                            <div class="thermostat-container">

                                <div class="thermostat-header">
                                    <div class="thermostat-title">Thermostat</div>
                                    <div class="power-switch">
                                        <span class="power-label">On</span>
                                        <label class="switch">
                                            <input type="checkbox" id="power-toggle" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>

                                <div class="thermostat-dial" id="thermostat-dial">
                                    <div class="dial-centre">
                                        <div class="status">HEATING</div>
                                        <div class="temperature-display" id="temp-display">21</div>
                                        <div class="status-icon"></div>
                                    </div>
                                    <div class="dial-handle" id="dial-handle"></div>
                                </div>

                            </div>
                        </div>
                    </div>
                   
                    <!-- Analog Clock Section -->
                    <div class="info-card clock">
                        <div class="info-card-content">
                            <div class="clock-container">
                                <div class="clock-header">
                                    <div class="clock-title">Clock</div>
                                </div>
                                
                                <!-- Analog Clock Face -->
                                <div class="analog-clock">
                                    <div class="clock-face">
                                        <div class="marking marking-12"></div>
                                        <div class="marking marking-3"></div>
                                        <div class="marking marking-6"></div>
                                        <div class="marking marking-9"></div>
                                        
                                        <div class="hand hour-hand" id="hour-hand"></div>
                                        <div class="hand minute-hand" id="minute-hand"></div>
                                        <div class="hand second-hand" id="second-hand"></div>
                                        <div class="center-dot"></div>
                                    </div>
                                </div>
                                
                                <!-- Digital Display at Bottom -->
                                <div class="digital-display">
                                    <div class="time" id="clock-time">00:00:00</div>
                                    <div class="date" id="clock-date">Monday, Jan 1</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    
                    <!-- Green Energy Recommendation -->
                    <div class="energy-recommendation">
                        <div class="recommendation-header">
                            <div class="recommendation-title">Green Energy Recommendation</div>
                        </div>
                        <div class="recommendation-content">
                            <strong>Lighting:</strong> Lights have consumed the most energy this week (45kWh). Consider switching unnecessary lights.
                        </div>
                    </div>

                </div>
            </div>

            <!-- Company Name -->
            <div class="divLight" style="margin-top:50px;">
                <p id="companyName">PearCare.Inc</p>
                <div id="line" style="margin: auto;"></div>
            </div>


        </div>


     

        <script>
            window.onerror = function(msg, url, line, col, error) {
                const errorDisplay = document.getElementById('errorDisplay');
                errorDisplay.style.display = 'block';
                errorDisplay.innerHTML = `An error occurred: ${msg}<br>Line: ${line}`;
                console.error('Global error:', error);
                return false;
            };
        </script>

        <script>
            function updateClock() {
                    const now = new Date();
                    const hours = now.getHours();
                    const minutes = now.getMinutes();
                    const seconds = now.getSeconds();
                    
                    // Update analog clock hands
                    const hourDeg = (hours % 12) * 30 + minutes * 0.5; // 30 degrees per hour + adjustment for minutes
                    const minuteDeg = minutes * 6; // 6 degrees per minute
                    const secondDeg = seconds * 6; // 6 degrees per second
                    
                    document.getElementById('hour-hand').style.transform = `rotate(${hourDeg}deg)`;
                    document.getElementById('minute-hand').style.transform = `rotate(${minuteDeg}deg)`;
                    document.getElementById('second-hand').style.transform = `rotate(${secondDeg}deg)`;
                    
                    // Update digital display
                    const hoursDisplay = hours.toString().padStart(2, '0');
                    const minutesDisplay = minutes.toString().padStart(2, '0');
                    const secondsDisplay = seconds.toString().padStart(2, '0');
                    document.getElementById('clock-time').textContent = `${hoursDisplay}:${minutesDisplay}:${secondsDisplay}`;
                    
                    // Update date
                    const options = { weekday: 'long', month: 'short', day: 'numeric' };
                    document.getElementById('clock-date').textContent = now.toLocaleDateString('en-US', options);
                    
                    // Call this function every second
                    setTimeout(updateClock, 1000);
                }

                // Start the clock when the page loads
                window.onload = function() {
                    updateClock();
                };
        </script>
        
        <script type="module" src="./javascript/powerUsage.js"></script>
        <script type="module" src="./javascript/dashboard.js"></script>
        <script type="module" src="./javascript/add-device.js"></script>
        <script type="module" src="./javascript/thermostat.js"></script>
    </body>
</html>