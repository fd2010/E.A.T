<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Dashboard - E.A.T</title>
        <link rel="stylesheet" href="./css/powerUsagePage.css">
        <link href="https://fonts.googleapis.com/css2?family=Kay+Pho+Du&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="./css/main.css">
        <link rel="stylesheet" href="./css/formstyles.css">
        <link rel="stylesheet" href="./css/dashboard.css">
        <link rel="stylesheet" href="./css/addDevice.css">
        <link rel="stylesheet" href="./css/thermostat.css">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <style>
            /* Reset and Base Styles */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
    
            body {
                font-family: "Montserrat", sans-serif;
                background-color: #e4dfa3;
                min-height: 100vh;
                display: flex;
                overflow-x: hidden;
            }
            
            /* Side Navigation */
            .side-nav {
                width: 120px;
                background-color: #C1B99F;
                height: 100vh;
                position: fixed;
                left: 0;
                top: 0;
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 20px 0;
                z-index: 100;
            }
            
            .nav-logo {
                width: 60px;
                height: 60px;
                margin-bottom: 40px;
            }
            
            .nav-icons {
                display: flex;
                flex-direction: column;
                gap: 30px;
                align-items: center;
            }
            
            .nav-icon {
                width: 36px;
                height: 36px;
                cursor: pointer;
                transition: transform 0.2s;
            }
            
            .nav-icon:hover {
                transform: scale(1.1);
            }
            
            .logout-icon {
                margin-top: auto;
                margin-bottom: 20px;
            }
            
            /* Main Content */
            .main-content {
                flex: 1;
                margin-left: 120px;
                padding: 20px;
                display: flex;
                flex-direction: column;
                min-height: 100vh;
            }
            
            /* Header */
            .header {
                display: flex;
                justify-content: space-between;
                margin-bottom: 20px;
                align-items: flex-start;
            }
            
            .greeting-bubble {
                background-color: #a4cde3;
                border-radius: 10px;
                padding: 15px 25px;
                max-width: 70%;
            }
            
            .greeting-text {
                font-family: "Kay Pho Du", sans-serif;
                font-size: 22px;
                margin-bottom: 5px;
            }
            
            .weather-info {
                font-size: 16px;
                color: #333;
            }
            
            .temperature {
                font-weight: bold;
                font-size: 20px;
            }
            
            .weather-desc {
                font-size: 14px;
                color: #555;
            }
            
            .user-profile {
                background-color: #000; 
                padding: 15px 20px;
                border-radius: 20px;
                width: 400px;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .profile-icon {
                width: 50px;
                height: 50px;
                background-color: #fff;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .profile-icon img {
                width: 80%;
                height: 80%;
            }
            
            .user-role {
                background-color: #f5f5f5;
                padding: 5px 15px;
                border-radius: 15px;
                font-size: 14px;
            }
            
           
            .user-profile-options {
                display: flex;
                gap: 10px;
            }

            .user-profile-options li {
                list-style: none;
                background-color: white;
                border-radius: 50%;
                width: 25px;
                height: 25px;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .user-profile-options li img {
                width: 15px;
                height: 15px;
                object-fit: contain;
            }


            .logout-btn {
                font-family: "Kay Pho Du", sans-serif;
                border: none;
                cursor: pointer;
                background: transparent;
                padding: 0;
                display: flex;
                justify-content: center;
                align-items: center;
                width: 100%;
                height: 100%;
            }

            .logout-btn img {
                width: 15px;
                height: 15px;
            }
            
            /* Dashboard Grid */
            .dashboard-grid {
                display: grid;
                grid-template-columns: 1fr 400px; 
                grid-template-rows: auto auto;
                gap: 20px;
                flex: 1;
                width: 100%;
            }
            
            /* Device Section */
            .devices-section {
                grid-column: 1 / 2;
                grid-row: 1 / 2;
                background-color: #eeeeeebb;
                border-radius: 20px;
                padding: 20px;
                width: 100%; 
                min-width: 0; 
            }
            
            .section-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
            }
            
            .section-title {
                font-family: "Kay Pho Du", sans-serif;
                font-size: 20px;
                font-weight: 500;
            }
            
            .room-temp {
                font-size: 16px;
                font-weight: 500;
            }
            
            .room-selector {
                padding: 5px 10px;
                border-radius: 15px;
                border: none;
                background-color: #f5f5f5;
                margin-left: 10px;
                cursor: pointer;
            }
            
            /* Horizontal scrolling room tabs */
            .room-tabs {
                display: flex;
                gap: 15px;
                overflow-x: auto;
                padding-bottom: 10px;
                margin-bottom: 15px;
                scrollbar-width: thin;
            }
            
            .room-tab {
                min-width: 130px;
                flex: 0 0 auto;
                padding: 10px 20px;
                border-radius: 20px;
                cursor: pointer;
                white-space: nowrap;
                font-family: "Kay Pho Du", sans-serif;
                background-color: #e4dfa3;
                text-align: center;
                transition: background-color 0.3s ease, transform 0.2s ease-in-out;
            }
            
            .room-tab:hover {
                transform: scale(1.05);
            }
            
            .room-tab.active {
                background-color: #9BA87C;
                color: white;
            }
            
            /* Devices grid with 1 rows max, then scroll */
            .devices-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 15px;
                height: 300px;
                overflow-y: auto;
                padding-right: 5px;
                min-width:90% ;
            }
            
            /* Default state (off) */
            .device-card {
                background-color: #292D32;
                color: white;
                border-radius: 10px;
                padding: 15px;
                display: flex;
                flex-direction: column;
                align-items: center;
                height: 200px;
                position: relative;
            }

            /* Active state (on) */
            .device-card.device-card-active {
                background-color: #DBC99F;
                color: black;
            }

            /* Text color adjustments for device info */
            .device-card .device-info,
            .device-card .device-type {
                color: #aaa;
            }

            .device-card.device-card-active .device-info,
            .device-card.device-card-active .device-type {
                color: #555;
            }

            /* You can also add a transition for smooth color changes */
            .device-card {
                transition: background-color 0.3s ease, color 0.3s ease;
            }
            
            .device-icon {
                width: 40px;
                height: 40px;
                margin-bottom: 10px;
            }
            
            .device-name {
                font-size: 16px;
                font-weight: 500;
                margin-bottom: 5px;
            }
            
            .device-info {
                font-size: 14px;
                color: #555;
                margin-bottom: 15px;
            }
            
            .device-card.off .device-info {
                color: #aaa;
            }
            
            /* Toggle switch */
            .toggle-switch {
                position: absolute;
                bottom: 15px;
                right: 15px;
            }
            
            .switch {
                position: relative;
                display: inline-block;
                width: 40px;
                height: 20px;
            }
            
            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }
            
            .slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #ccc;
                transition: .4s;
                border-radius: 20px;
            }
            
            .slider:before {
                position: absolute;
                content: "";
                height: 16px;
                width: 16px;
                left: 3px;
                bottom: 2px;
                background-color: white;
                transition: .4s;
                border-radius: 50%;
            }
            
            input:checked + .slider {
                background-color: #9BA87C;
            }
            
            input:checked + .slider:before {
                transform: translateX(18px);
            }
            
            /* Energy Section */
            .energy-section {
                grid-column: 1 / 2;
                grid-row: 2 / 3;
                background-color: #fff;
                border-radius: 20px;
                padding: 20px;
            }
            
            .graph-header {
                display: flex;
                justify-content: space-between;
                margin-bottom: 15px;
            }
            
            .graph-title {
                font-family: "Kay Pho Du", sans-serif;
                font-size: 18px;
            }
            
            .graph-period {
                padding: 5px 10px;
                border-radius: 15px;
                border: none;
                background-color: #f5f5f5;
                cursor: pointer;
            }
            
            .chart-container {
                height: 250px;
                width: 100%;
            }
            
            /* Thermostat Section */
            .sidebar-section {
                width: 400px; /* Fixed width */
                grid-column: 2 / 3;
                grid-row: 1 / 3;
                background-color: #f5f5f5;
                border-radius: 20px;
                padding: 20px;
                display: flex;
                flex-direction: column;
            }
            
            .thermostat-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
            }
            
            .thermostat-title {
                font-family: "Kay Pho Du", sans-serif;
                font-size: 18px;
                font-weight: 500;
            }
            
            /* Thermostat Dial */
            .thermostat-container {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }
            
            .thermostat-dial {
                position: relative;
                width: 220px;
                height: 220px;
                border-radius: 50%;
                background-color: white;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                display: flex;
                justify-content: center;
                align-items: center;
                margin: 0 auto 30px;
            }
            
            .temperature-markers {
                position: absolute;
                width: 100%;
                height: 100%;
                border-radius: 50%;
            }
            
            .temperature-marker {
                position: absolute;
                width: 2px;
                height: 10px;
                background-color: #ddd;
                transform-origin: center bottom;
            }
            
            .temperature-label {
                position: absolute;
                font-size: 12px;
                color: #888;
            }
            
            .dial-center {
                width: 150px;
                height: 150px;
                border-radius: 50%;
                background-color: #f8f8f8;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
            }
            
            .heating-label {
                font-size: 14px;
                color: #666;
                text-transform: uppercase;
                margin-bottom: 5px;
            }
            
            .temperature-display {
                font-size: 60px;
                font-weight: 300;
                color: #333;
                line-height: 1;
                font-family: "Kay Pho Du", sans-serif;
            }
            
            .eco-icon {
                margin-top: 10px;
                color: #4CAF50;
                font-size: 24px;
            }
            
            /* Energy Recommendation */
            .energy-recommendation {
                background-color: #9BA87C;
                border-radius: 20px;
                padding: 20px;
                margin-top: 30px;
            }
            
            .recommendation-header {
                display: flex;
                align-items: center;
                margin-bottom: 15px;
                color: #fff;
            }
            
            .recommendation-icon {
                width: 30px;
                height: 30px;
                margin-right: 10px;
                background-color: #FFDC52;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .recommendation-title {
                font-family: "Kay Pho Du", sans-serif;
                font-size: 18px;
            }
            
            .recommendation-content {
                color: #fff;
                font-size: 14px;
                line-height: 1.5;
            }
            
            /* Company Branding */
            .company-branding {
                text-align: center;
                margin-top: 20px;
            }
            
            .company-name {
                color: #333;
                font-size: 14px;
                margin-bottom: 5px;
            }
            
            .divider {
                width: 110px;
                height: 1px;
                background: #333;
                margin: 0 auto;
            }
            
            /* Loading and Error States */
            #loadingState, #errorDisplay {
                text-align: center;
                padding: 20px;
                font-family: "Kay Pho Du", sans-serif;
                margin-left: 120px;
            }
            
            #errorDisplay {
                color: #c62828;
                display: none;
            }
            
            /* Responsive Design */
            @media (max-width: 1200px) {
                .dashboard-grid {
                    grid-template-columns: 1fr;
                    grid-template-rows: auto auto auto;
                }
                
                .thermostat-section {
                    grid-column: 1 / 2;
                    grid-row: 3 / 4;
                    max-width: 100%;
                }

                .devices-section {
                    width: 100%;
                }

            }
            
            @media (max-width: 768px) {
                .side-nav {
                    width: 80px;
                }
                
                .main-content {
                    margin-left: 80px;
                }
                
                .greeting-bubble {
                    max-width: 60%;
                }
                
                #loadingState, #errorDisplay {
                    margin-left: 80px;
                }
            }
            
            @media (max-width: 480px) {
                .header {
                    flex-direction: column;
                    gap: 20px;
                    align-items: center;
                }
                
                .greeting-bubble {
                    max-width: 100%;
                }
            }
        </style>
    </head>
    
    <body>
        <!-- Loading and Error States -->
        <div id="loadingState">Loading dashboard...</div>
        <div id="errorDisplay"></div>
    
        <!-- Side Navigation -->
        <nav class="side-nav">
            <div class="nav-logo">
                <img src="./images/icons/User Profile Icon.png" alt="Logo">
            </div>
            <div class="nav-icons">
                <a href="dashboard.html"><img src="./images/icons/Home Icon.png" alt="Home" class="nav-icon"></a>
                <a href="powerUsage.html"><img src="./images/icons/View Stats Icon.png" alt="Stats" class="nav-icon"></a>
                <a href="manage devices.html"><img src="./images/icons/tablet device (MIT licence).png" alt="Manage Devices" class="nav-icon"></a>
                <img src="./images/icons/Add Device Icon.png" alt="Add Device" class="nav-icon" onclick="showAddDevice()">
            </div>
            <div class="logout-icon">
                <img src="./images/icons/User Profile Icon.png" alt="Logout" class="nav-icon">
            </div>
        </nav>
    
        <!-- Main Content -->
        <div id="dashboardContent" class="main-content">
            <!-- Header Section -->
            <div class="header">
                <!-- Greeting Bubble -->
                <div class="greeting-bubble">
                    <div class="greeting-text">Hi, <span id="prefName"> Loading name...</span> ðŸ‘‹</div>
                    <div class="weather-info">
                        <div id="current-temprature" class="temperature">Loading temprature...</div>
                        <div class="weather-desc">Loading weather description...</div>
                    </div>
                </div>
                
                <!-- User Profile -->
                <div class="user-profile">
                    <div class="profile-icon">
                        <img src="./images/icons/User Profile Icon.png" alt="User">
                    </div>
                    <div class="user-role" id="userRole">Loading role... </div>
                    <div>
                        <ul class="user-profile-options">
                            
                            <li><img src="./images/icons/settings cog (MIT).png" alt="Settings"></li>
                            <li><img src="./images/icons/notification bell.png" alt="Notifications"></li>
                            <li><button id="logoutBtn" class="logout-btn"><img src="./images/icons/logout icon.png" alt="Logout" title="Logout"></button></li>

                        </ul>

                        
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- Devices Section -->
                <div class="devices-section">
                    <div class="section-header">
                        <div class="section-title">My Devices</div>
                    </div>
                    
                    <!-- Room Navigation -->
                    <div class="room-tabs" id="roomTabs">
                    </div>
                    
                    <!-- Devices Grid -->
                    <div class="devices-grid" id="devicesGrid">
                    </div>
                </div>
                
                <!-- Energy Consumption Section -->
                <div class="energy-section">
                    <div class="graph-header">
                        <div class="graph-title">Power Consumption</div>
                        <div class="graph-buttons">
                            <div class="graph-buttons">
                                <button id="daily">Daily</button>
                                <button id="weekly">Weekly</button>
                                <button id="monthly">Monthly</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chart -->
                    <div class="chart-container">
                        <canvas id="energyCostChart"></canvas>
                    </div>
                </div>
                
                <!-- Thermostat Section -->
                <div class="sidebar-section">
                    
                    <!-- Thermostat Dial -->
                    <div class="thermostat-container">
                        <div class="info-card temprature">
                            <div class="info-card-content">
                                <div class="thermostat-container">
                                    <div class="thermostat-header">
                                        <div class="thermostat-title">Thermostat</div>
                                        <div class="power-switch">
                                            <span class="power-label">On</span>
                                            <label class="switch">
                                                <input type="checkbox" id="power-toggle" checked>
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="thermostat-dial" id="thermostat-dial">
                                        <div class="dial-center">
                                            <div class="status">HEATING</div>
                                            <div class="temperature-display" id="temp-display">21</div>
                                            <div class="status-icon"></div>
                                        </div>
                                        <div class="dial-handle" id="dial-handle"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    
                    <!-- Green Energy Recommendation -->
                    <div class="energy-recommendation">
                        <div class="recommendation-header">
                            <div class="recommendation-title">Green Energy Recommendation</div>
                        </div>
                        <div class="recommendation-content">
                            <strong>Lighting:</strong> Lights have consumed the most energy this week (45kWh). Consider switching unnecessary lights.
                        </div>
                    </div>

                </div>
            </div>

            <!-- Company Name -->
            <div class="divLight" style="margin-top:50px;">
                <p id="companyName">PearCare.Inc</p>
                <div id="line" style="margin: auto;"></div>
            </div>


        </div>


     

        <script>
            window.onerror = function(msg, url, line, col, error) {
                const errorDisplay = document.getElementById('errorDisplay');
                errorDisplay.style.display = 'block';
                errorDisplay.innerHTML = `An error occurred: ${msg}<br>Line: ${line}`;
                console.error('Global error:', error);
                return false;
            };
        </script>
        
        <script type="module" src="./javascript/powerUsage.js"></script>
        <script type="module" src="./javascript/dashboard.js"></script>
        <script type="module" src="./javascript/add-device.js"></script>
        <script type="module" src="./javascript/thermostat.js"></script>
    </body>
</html>